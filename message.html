<!doctype html>
<html class="no-js" lang="">

  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">

    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon"
      href="https://firebasestorage.googleapis.com/v0/b/gdg2022-f218d.appspot.com/o/static%2Fgdg.svg?alt=media&token=1295bb63-71b7-4634-9192-377fba3515a1"
      />
    <!-- Place favicon.ico in the root directory -->

    <title>Google Developer Group 2022</title>

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous">
    <meta name="theme-color" content="#fafafa">
    <script src="dist/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="dist/sweetalert2.min.css">

  </head>

  <body class="d-flex flex-column h-100">

    <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
          <img style="width: 70px; height: 70px;"
            src="https://firebasestorage.googleapis.com/v0/b/gdg2022-f218d.appspot.com/o/static%2Fgdg.svg?alt=media&token=1295bb63-71b7-4634-9192-377fba3515a1"
            alt="GDG" />
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarCollapse" aria-controls="navbarCollapse"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav me-auto ms-5 mb-2 mb-md-0">
              <li class="nav-item me-0 me-md-3">
                <a class="nav-link" href="index.html">Accueil</a>
              </li>
              <li class="nav-item mx-0 mx-md-3">
                <a class="nav-link"
                  href="storage.html">Cloud Storage</a>
              </li>
              <li class="nav-item mx-0 mx-md-3">
                <a class="nav-link text-warning fw-bold active"
                  aria-current="page" href="message.html">Cloud Messaging</a>
              </li>
              <li class="nav-item ms-0 ms-md-3">
                <a class="nav-link" href="#">Crashlytics</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Begin page content -->
    <main class="d-flex mb-5" style="height: 88vh; background:
      url('img/web.png'); background-repeat: no-repeat; background-size: cover">
      <div class="container text-center align-content-center align-items-center
        align-self-center flex mt-3">
        <h1 class="text-center">Firebase Cloud Messaging</h1><br/><br/>

            <img id="image" src="img/fcm.png" class="rounded
              mx-auto d-block" style="width: 500px; height: auto;" alt="GDG
              Image Place Holder">

            <button type="button" class="btn btn-primary w-50" id="btn"> Charger
              la notification &nbsp; <b class="fa fa-paper-plane"></b></button>
          </div>
        </main>

        <footer class="footer mt-auto py-4 bg-dark text-white">
          <div class="container text-center">
            <span class="text-muted">&copy; Copyright GDG <script>document.write(new Date().getFullYear())</script>.
              Tous droits reserv&eacute;s</span>
          </div>
        </footer>

        <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
          crossorigin="anonymous"></script>
        <script src="js/vendor/modernizr-3.11.2.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.3.min.js"
          integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
          crossorigin="anonymous"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
        <script
          src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
        <script
          src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
        <script type="module">

            var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
            var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl)
            })

            var firebaseConfig = {
              apiKey: "AIzaSyA0etWKm_lV1QL7QFBaex5vc9iHjFKqPEg",
              authDomain: "gdg2022-f218d.firebaseapp.com",
              projectId: "gdg2022-f218d",
              storageBucket: "gdg2022-f218d.appspot.com",
              messagingSenderId: "359751155735",
              appId: "1:359751155735:web:905644fb717225bc235c52",
              measurementId: "G-CHW75DB2KE"
            };
            firebase.initializeApp(firebaseConfig);
            firebase.analytics()

            const messaging = firebase.messaging();

            const check = () => {
              if (!('serviceWorker' in navigator)) {
                throw new Error('No Service Worker support!')
              }
              if (!('PushManager' in window)) {
                throw new Error('No Push API Support!')
              }
            }

            const registerServiceWorker = async () => {
                const swRegistration = await navigator.serviceWorker.register('service.js'); //notice the file name
                return swRegistration;
            }

            const requestNotificationPermission = async () => {
                const permission = await window.Notification.requestPermission();
                // value of permission can be 'granted', 'default', 'denied'
                // granted: user has accepted the request
                // default: user has dismissed the notification permission popup by clicking on x
                // denied: user has denied the request.
                if(permission !== 'granted'){
                    throw new Error('Permission not granted for Notification');
                }
            }


            const main = async () => { //notice I changed main to async function so that I can use await for registerServiceWorker
                check();
                const swRegistration = await registerServiceWorker();
                const permission =  await requestNotificationPermission();
            }

            main();

        </script>
        <script src="https://www.google-analytics.com/analytics.js" async></script>
      </body>

    </html>
